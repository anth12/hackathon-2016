App.service("UserService",["$http",function(e){var r={currentUser:null,getCurrentUser:function(){var t=Q.defer(),s=localStorage.getItem("SessionId");return null==s?e.post("/api/user/create").then(function(e){if(r.currentUser=e.data,r.currentUser.Sessions.length<0)throw Error("Invalid session");var s=r.currentUser.Sessions[r.currentUser.Sessions.length-1];localStorage.setItem("SessionId",s.ClientId),t.resolve(r.currentUser)}):e.get("/api/user/"+s).then(function(e){r.currentUser=e.data,t.resolve(r.currentUser)}),t.promise}};return r}]);