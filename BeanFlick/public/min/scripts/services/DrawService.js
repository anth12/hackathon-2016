App.service("DrawService",function(t,e,h,o,a,i){function n(){f(),m(),u(),v.drawImage(d.image,o.face.shiftX,d.positionY,d.width,d.height),c(),v.drawImage(D,o.face.shiftX,w),r(),v.drawImage(g.image,h.x-g.centerX,h.y-g.centerY,g.width,g.height),window.requestAnimationFrame(function(){n()})}function m(){v.beginPath(),v.rect(0,0,e.width,e.height),v.fillStyle="#17c2a4",v.fill()}function r(){var t="Flick Your Bean";v.beginPath(),v.rect(0,e.height-a.throwAreaHeight,e.width,a.throwAreaHeight),v.fillStyle="#d74680",v.fill(),v.beginPath(),v.font="70px Arial",v.fillStyle="#db6190",v.fillText(t,e.width/2-v.measureText(t).width/2,e.height-a.throwAreaHeight/2)}function u(){0>=w-50&&a.mouthClosed?w+=a.mouthSpeed:(a.mouthClosed=!1,w-=a.mouthSpeed,0>=w&&(a.mouthClosed=!0)),h.mouthOpening=w}function l(){y.beginPath(),y.moveTo(a.mouthData.mouthLeft.x,a.mouthData.mouthLeft.y),y.lineTo(a.mouthData.mouthRight.x,a.mouthData.mouthRight.y),y.lineTo(a.mouthData.mouthRight.x,a.mouthData.mouthRight.y+50),y.lineTo(a.mouthData.mouthLeft.x,a.mouthData.mouthLeft.y+50-(a.mouthData.mouthLeft.y-a.mouthData.mouthRight.y)),y.closePath(),y.clip(),y.drawImage(d.image,0,d.positionY,d.width,d.height)}function c(){v.beginPath(),v.fillStyle="black",v.moveTo(a.mouthData.mouthLeft.x+o.face.shiftX,a.mouthData.mouthLeft.y),v.lineTo(a.mouthData.mouthRight.x+o.face.shiftX,a.mouthData.mouthRight.y),v.lineTo(a.mouthData.mouthRight.x+o.face.shiftX,a.mouthData.mouthRight.y+50),v.lineTo(a.mouthData.mouthLeft.x+o.face.shiftX,a.mouthData.mouthLeft.y+50-(a.mouthData.mouthLeft.y-a.mouthData.mouthRight.y)),v.closePath(),v.fill()}function f(){e.canvasContext.clearRect(0,0,e.width,e.height)}var s,g,d,w,v,D,y;this.draw=function(){g=o.throwable,d=o.face,o.face.shiftX=(e.width-d.width)/2,v=e.canvasContext,D=document.createElement("canvas"),D.width=d.width,D.height=d.height,y=D.getContext("2d"),w=0,m(),l(),n()},this.movement=function(){var n=t.defer();a.powerSetting;return s=setInterval(function(){var t=i.scored();t&&(clearInterval(s),n.resolve({stop:!0,scored:!0}));var a=i.friction();a&&(clearInterval(s),n.resolve({stop:!0,scored:!1})),h.y-o.throwable.centerY>0&&h.y+o.throwable.centerY<e.height?h.y-=h.movementData.speedY/300:(clearInterval(s),n.resolve({stop:!0,scored:!1})),h.x-o.throwable.centerX>0&&h.x+o.throwable.centerX<e.width?h.x+=h.movementData.speedX/300:(clearInterval(s),n.resolve({stop:!0,scored:!1}))}),n.promise}});