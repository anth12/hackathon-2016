App.service("DrawService",function(t,e,o,h,a,i){function n(){f(),m(),u(),v.drawImage(d.image,h.face.shiftX,d.positionY,d.width,d.height),c(),v.drawImage(D,h.face.shiftX,w+d.positionY),r(),v.drawImage(g.image,o.x-g.centerX,o.y-g.centerY,g.width,g.height),window.requestAnimationFrame(function(){n()})}function m(){v.beginPath(),v.rect(0,0,e.width,e.height),v.fillStyle="#17c2a4",v.fill()}function r(){var t="Flick Your Bean";v.beginPath(),v.rect(0,e.height-a.throwAreaHeight,e.width,a.throwAreaHeight),v.fillStyle="#d74680",v.fill(),v.beginPath(),v.font="70px Arial",v.fillStyle="#db6190",v.fillText(t,e.width/2-v.measureText(t).width/2,e.height-a.throwAreaHeight/2)}function u(){0>=w-50&&a.mouthClosed?w+=a.mouthSpeed:(a.mouthClosed=!1,w-=a.mouthSpeed,0>=w&&(a.mouthClosed=!0)),o.mouthOpening=w}function l(){p.beginPath(),p.moveTo(a.mouthData.mouthLeft.x,a.mouthData.mouthLeft.y),p.lineTo(a.mouthData.mouthRight.x,a.mouthData.mouthRight.y),p.lineTo(a.mouthData.mouthRight.x,a.mouthData.mouthRight.y+50),p.lineTo(a.mouthData.mouthLeft.x,a.mouthData.mouthLeft.y+50-(a.mouthData.mouthLeft.y-a.mouthData.mouthRight.y)),p.closePath(),p.clip(),p.drawImage(d.image,0,d.positionY,d.width,d.height)}function c(){v.beginPath(),v.fillStyle="black",v.moveTo(a.mouthData.mouthLeft.x+h.face.shiftX,a.mouthData.mouthLeft.y+d.positionY),v.lineTo(a.mouthData.mouthRight.x+h.face.shiftX,a.mouthData.mouthRight.y+d.positionY),v.lineTo(a.mouthData.mouthRight.x+h.face.shiftX,a.mouthData.mouthRight.y+50+d.positionY),v.lineTo(a.mouthData.mouthLeft.x+h.face.shiftX,a.mouthData.mouthLeft.y+50+d.positionY-(a.mouthData.mouthLeft.y-a.mouthData.mouthRight.y)),v.closePath(),v.fill()}function f(){e.canvasContext.clearRect(0,0,e.width,e.height)}var s,g,d,w,v,D,p;this.draw=function(){g=h.throwable,d=h.face,h.face.shiftX=(e.width-d.width)/2,v=e.canvasContext,D=document.createElement("canvas"),D.width=d.width,D.height=d.height,p=D.getContext("2d"),w=0,m(),l(),n()},this.movement=function(){var n=t.defer();a.powerSetting;return s=setInterval(function(){var t=i.scored();t&&(clearInterval(s),n.resolve({stop:!0,scored:!0}));var a=i.friction();a&&(clearInterval(s),n.resolve({stop:!0,scored:!1})),o.y-h.throwable.centerY>0&&o.y+h.throwable.centerY<e.height?o.y-=o.movementData.speedY/300:(clearInterval(s),n.resolve({stop:!0,scored:!1})),o.x-h.throwable.centerX>0&&o.x+h.throwable.centerX<e.width?o.x+=o.movementData.speedX/300:(clearInterval(s),n.resolve({stop:!0,scored:!1}))}),n.promise}});