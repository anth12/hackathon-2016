App.service("DrawService",function(t,e,o,h,a,i,n){function m(){s(),r(),l(),D.drawImage(w.image,h.face.shiftX,w.positionY,w.width,w.height),f(),D.drawImage(p,h.face.shiftX,v+w.positionY),u(),D.drawImage(d.image,o.x-d.centerX,o.y-d.centerY,d.width,d.height),n.animation=window.requestAnimationFrame(function(){m()})}function r(){D.beginPath(),D.rect(0,0,e.width,e.height),D.fillStyle="#17c2a4",D.fill()}function u(){var t="Flick Your Bean";D.beginPath(),D.rect(0,e.height-a.throwAreaHeight,e.width,a.throwAreaHeight),D.fillStyle="#d74680",D.fill(),D.beginPath(),D.font="70px Arial",D.fillStyle="#db6190",D.fillText(t,e.width/2-D.measureText(t).width/2,e.height-a.throwAreaHeight/2)}function l(){0>=v-50&&a.mouthClosed?v+=a.mouthSpeed:(a.mouthClosed=!1,v-=a.mouthSpeed,0>=v&&(a.mouthClosed=!0)),o.mouthOpening=v}function c(){y.beginPath(),y.moveTo(a.mouthData.mouthLeft.x,a.mouthData.mouthLeft.y),y.lineTo(a.mouthData.mouthRight.x,a.mouthData.mouthRight.y),y.lineTo(a.mouthData.mouthRight.x,a.mouthData.mouthRight.y+50),y.lineTo(a.mouthData.mouthLeft.x,a.mouthData.mouthLeft.y+50-(a.mouthData.mouthLeft.y-a.mouthData.mouthRight.y)),y.closePath(),y.clip(),y.drawImage(w.image,0,0,w.width,w.height)}function f(){D.beginPath(),D.fillStyle="black",D.moveTo(a.mouthData.mouthLeft.x+h.face.shiftX,a.mouthData.mouthLeft.y+w.positionY),D.lineTo(a.mouthData.mouthRight.x+h.face.shiftX,a.mouthData.mouthRight.y+w.positionY),D.lineTo(a.mouthData.mouthRight.x+h.face.shiftX,a.mouthData.mouthRight.y+50+w.positionY),D.lineTo(a.mouthData.mouthLeft.x+h.face.shiftX,a.mouthData.mouthLeft.y+50+w.positionY-(a.mouthData.mouthLeft.y-a.mouthData.mouthRight.y)),D.closePath(),D.fill()}function s(){e.canvasContext.clearRect(0,0,e.width,e.height)}var g,d,w,v,D,p,y;this.draw=function(){d=h.throwable,w=h.face,h.face.shiftX=(e.width-w.width)/2,D=e.canvasContext,p=document.createElement("canvas"),p.width=w.width,p.height=w.height,y=p.getContext("2d"),v=0,r(),c(),m()},this.movement=function(){var n=t.defer();a.powerSetting;return g=setInterval(function(){var t=i.scored();t&&(clearInterval(g),n.resolve({stop:!0,scored:!0}));var a=i.friction();a&&(clearInterval(g),n.resolve({stop:!0,scored:!1})),o.y-h.throwable.centerY>0&&o.y+h.throwable.centerY<e.height?o.y-=o.movementData.speedY/300:(clearInterval(g),n.resolve({stop:!0,scored:!1})),o.x-h.throwable.centerX>0&&o.x+h.throwable.centerX<e.width?o.x+=o.movementData.speedX/300:(clearInterval(g),n.resolve({stop:!0,scored:!1}))}),n.promise}});